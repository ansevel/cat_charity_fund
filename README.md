# Приложение для Благотворительного фонда поддержки котиков QRKot


## Описание проекта

Фонд собирает пожертвования на различные целевые проекты: 
на медицинское обслуживание нуждающихся хвостатых, на обустройство 
кошачьей колонии в подвале, на корм оставшимся без попечения кошкам — 
на любые цели, связанные с поддержкой кошачьей популяции.


### Технологии
- Python 3.9


## Как запустить

- Клонировать репозиторий и перейти в него в командной строке:

  ```
  git clone 
  ```
  
  ```
  cd cat_charity_fund
  ```

- Cоздать и активировать виртуальное окружение:

  ```
  python3 -m venv venv
  ```

  * Если у вас Linux/macOS
  
    ```
    source venv/bin/activate
    ```
  
  * Если у вас windows
  
    ```
    source venv/scripts/activate
    ```

- Установить зависимости из файла requirements.txt:

  ```
  python3 -m pip install --upgrade pip
  ```
  
  ```
  pip install -r requirements.txt
  ```

- Создать в корневой директории проекта файл `.env` с переменными и указать их значения
  - APP_TITLE
  - APP_DESCRIPTION
  - DATABASE_URL
  - SECRET

- Выполнить миграции и создать базу данных SQLite
  ```
  alembic upgrade head
  ```

- Запустить проект командой в терминале `uvicorn app.main:app`

---

Проект будет доступен на локальном сервере по адресу <http://127.0.0.1:8000/>
- <http://127.0.0.1:8000/docs> - интерактивная документация Swagger
- <http://127.0.0.1:8000/redoc> - интерактивная документация ReDoc

---

## Технические подробности

В приложении используются три модели:
  - Пользователи
  - Проекты
  - Пожертвования
  

#### Пользователи

- Используется библиотека FastAPI Users.
- Транспорт Bearer и стратегию JWT.
- Используется базовая модель пользователя.
- Установлен запрет на удаление пользователей: эндпоинт удаления пользователя переопределен на **deprecated**.
  


#### Проекты

Столбцы таблицы charityproject:
 - id — первичный ключ;
 - name — уникальное название проекта;
 - description — описание;
 - full_amount — требуемая сумма;
 - invested_amount — внесённая сумма;
 - fully_invested — булево значение, указывающее на то, собрана ли нужная сумма для проекта (закрыт ли проект);
 - create_date — дата создания проекта;
 - close_date — дата закрытия проекта.


#### Пожертвования

Столбцы таблицы donation:
 - id — первичный ключ;
 - user_id — id пользователя, сделавшего пожертвование;
 - comment — комментарий;
 - full_amount — сумма пожертвования;
 - invested_amount — сумма из пожертвования, которая распределена по проектам;
 - fully_invested — булево значение, указывающее на то, все ли деньги из пожертвования были переведены в тот или иной проект;
 - create_date — дата пожертвования;
 - close_date — дата, когда вся сумма пожертвования была распределена по проектам.
 

#### Процесс «инвестирования»

Сразу после создания нового проекта или пожертвования запускается процесс 
«инвестирования». Если создан новый проект, а в базе были «свободные» 
(не распределённые по проектам) суммы пожертвований — они автоматически 
инвестируются в новый проект, и в ответе API эти суммы учтены. То же касается и 
создания пожертвований: если в момент пожертвования есть открытые проекты, эти 
пожертвования автоматически зачисляются на их счета.


#### Права пользователей   

**Любой посетитель сайта** (в том числе неавторизованный) может посмотреть список всех проектов.   

**Зарегистрированный пользователь** может:
- сделать пожертвование,
- просматривать только свои пожертвования.
  
*Информация о том, инвестировано пожертвование в какой-то проект или нет, обычному пользователю недоступна.*

**Суперпользователь** может:
- создавать проекты,
- удалять проекты, в которые не было внесено средств,
- изменять название и описание существующего проекта, устанавливать для него новую 
требуемую сумму (но не меньше уже внесённой),
- просматривать список всех пожертвований.
   
***Никто не может менять через API размер внесённых средств, удалять или модифицировать 
закрытые проекты, изменять даты создания и закрытия проектов, редактировать или 
удалять пожертвования***

Примеры запросов к API, варианты ответов и ошибок приведены в документации

## Автор
Андрей Великоречин
